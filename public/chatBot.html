<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>Chatbot</title>
    <link rel="stylesheet" type="text/css" href="css/chatbot.css">

    <script type="text/javascript">
      $(document).ready(function(){
        $("button").click(function(){
          var message = $("textarea").val();
          alert("message");
        })
      })
    </script>

  </head>


  <body>
    <div class="chatbox">
      <div class="chatlogs" id="chatlogs">

      </div>

      <form class="chat-form">
        <textarea id = "chatbox"></textarea>
        <button>Send</button>
      </form>

    </div>

    <script>

        const ws = new WebSocket('ws://' + window.location.host);
        let context;
        const form = document.querySelector('form');
        var ctr = 1;

        form.addEventListener('submit', function(e){
          e.preventDefault();
          e.stopImmediatePropagation();

          const input = this.querySelector('textarea').value;

          ws.send(JSON.stringify({
            text : input,
            context : context
          }));

        });

        ws.addEventListener('connection', function(e){
          console.log('connected');
        });

        ws.addEventListener('message', function(e){
          console.log(e);
          const data = JSON.parse(e.data);
          context = data.context;
          botmessage = data.output.text;
          myMessage = document.getElementById("chatbox").value;

          addMessages();

          //addMessages(myMessage,botmessage);





          //myfunction();
        });

        ws.addEventListener('error', function(err){
          console.log('ws error', err)
        })

        function addChatbotMessage(botmessage){
          document.getElementById('chatlogs').innerHTML += '<div class="chat friend"> <div class="user-photo"><img src="images/user-1.jpg"> </div><p class = "chat-message">'+ botmessage +'</p></div>';
        }

        function addMessages(){
          document.getElementById('chatlogs').innerHTML += '<div class="chat self"> <div class="user-photo"><img src="images/user-1.jpg"> </div><p class = "chat-message">'+ myMessage +'</p></div>';
          document.getElementById('chatlogs').innerHTML += '<div class="chat friend"> <div class="user-photo"><img src="images/user-1.jpg"> </div><p class = "chat-message">'+ botmessage +'</p></div>';
        }
        /*function myfunction(){
          var chatmessage = document.getElementById("chatbox").value;
          if(ctr = 1){

          }else {

          }
          console.log(chatmessage);
          document.getElementById("userMessage").innerHTML = chatmessage;
          document.getElementById('chatbotMessage').innerHTML = botmessage;
        }*/

    </script>

  </body>
</html>
